APP?=devsecops-demo

venv:
	python3.12 -m venv .venv && . .venv/bin/activate && pip install -r app/requirements.txt

lint:
	. .venv/bin/activate && flake8 app

test:
	. .venv/bin/activate && pytest -q

sast:
	. .venv/bin/activate && bandit -r app -x app/tests -ll

deps:
	. .venv/bin/activate && pip-audit -r app/requirements.txt || true

build:
	docker build -t $(APP):local .

scan:
	trivy image --exit-code 0 --severity HIGH,CRITICAL $(APP):local

deploy:
	./scripts/deploy_local.sh

rollback:
	./scripts/rollback_local.sh

logs:
	docker logs $$(docker ps --filter "name=_web" --format "{{.ID}}") --tail 100 -f

